{% extends "base.html" %}

<!-- {% set username = getSSOUsername(False) %} -->

{% from "listinc.html" import renderlink, clickstats with context %}

{% block titlekeyword %}{{ keyword }}{% endblock %}
{% block keyword %}{{ keyword }}{% endblock %}

{% block body %}

<div class="row">

<h3 class="center">{{ L.name }}</h3>
  <div class="col-md-10 col-md-offset-1">
  <div class="panel panel-default">

  <table class="table table-striped">
  {% if L %}
  <tr>
  <td colspan="3">
    <form action="/_setbehavior_" style="margin: 0; text-align: center;">
    <input type="hidden" name="keyword" value="{{ keyword }}"/>
    <b><a href="/{{ keyword|escapekeyword }}">go/{{ keyword }}</a></b> redirects to
    <select name="behavior" {% if not username %}disabled="true"{% endif %}>
       <option value="list" {% if L.redirect == "list" %}selected{% endif %}>this list of links</option>
       <option value="freshest" {% if L.redirect == "freshest" %}selected{% endif %}>the freshest link</option>
       <option value="top" {% if L.redirect == "top" %}selected{% endif %}>the most used link</option>
       <option value="random" {% if L.redirect == "random" %}selected{% endif %}>a random link</option>
       {% for link in popularLinks %}
           <option value="{{ link.id }}" {% if L.redirect == str(link.id) %}selected{% endif %}>{{ link.title or link.redirect }}</option>
       {% endfor %}
     </select>
     {% if username %}
     <button class="btn btn-primary btn-sm" type="submit" value="Change Behavior">Change Behavior</button>
     {% endif %}
    </form>
    </td>
    </tr>
    <!-- todo need count of links -->
    {% endif %}
    <tr>
    <td colspan="3">
    <h4 class="center">
  {% if username %}
    <a class="center" href="/_add_?ll={{ keyword|escapekeyword }}">Add new link</a>
  {% else %}
    <a href="/_login_?redirect={{ getCurrentEditableUrlQuoted() }}">Login to edit this list</a>
  {% endif %}
  </h4>
    </td>
  </tr>

  {% for link in popularLinks %}
      {% if popularLinks.index(link) == 0 %}
        {{ renderlink(popularLinks.index(link) + 1, link, username, L.name) }}
      {% else %}
        {{ renderlink(popularLinks.index(link) + 1, link, username) }}
      {% endif %}
  {% else %}
      <tr>
      <td><h4 class="center">No links for this keyword.</h4>
      </td>
      </tr>
  {% endfor %}
  </table>
  </div>
  </div>

  </div>

{{ clickstats(L) }}
{% endblock body %}
